<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Back to school: Winter Edition</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">


  <style>
    :root{
      /* LIGHT PASTEL THEME */
      --bg0:#fbfbff;
      --bg1:#f4f7ff;
      --bg2:#fff7f1;

      --panel: rgba(240,247,243,.90);   /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ */
      --panel2: rgba(245,250,247,.95);  /* —à–∞–ø–∫–∏ / –≤–ª–æ–∂–µ–Ω–Ω—ã–µ */
      --soft-yellow: #FFF7E6;

      --line: rgba(17,24,39,.10);

      --ink: #111827;       /* –í–°–Å –ß–Å–†–ù–´–ú/–¢–Å–ú–ù–´–ú */
      --muted: rgba(17,24,39,.62);

      --good: #16a34a;
      --bad: #dc2626;

      --accent: rgba(147,197,253,.90);
      --shadow: 0 16px 40px rgba(17,24,39,.10);
      --radius: 20px;

      --tap: 48px;

      /* —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ "–ø—É—Å—Ç–æ–≥–æ var(--warm-sand)" */
      --warm-sand: rgba(255,255,255,0);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--ink);
      font-family: "Nunito", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
font-weight: 400;
font-size: 16px;
line-height: 1.4;

      background-image: url("images/back.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    .wrap{
      max-width: 1220px;
      margin: 0 auto;
      padding: 16px;
      min-height: 100%;
      display:flex;
      align-items:center;
      justify-content:center;
      position: relative;
      z-index: 1;
    }

    .app{
      width:100%;
      border: 1px solid var(--line);
      border-radius: 26px;
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
      background: var(--panel);
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 6px 16px;
      border-bottom: 1px solid var(--line);
      background: var(--panel2);
      backdrop-filter: blur(10px);
    }

    .title{
      display:flex;
      flex-direction:column;
      gap: 6px;
      min-width: 280px;
    }
    .title h1{
      margin:0;
      font-size: 20px;
      letter-spacing:.4px;
      color: var(--ink);
    }
    .title .sub{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      font-weight: 700;
      line-height:1.25;
    }

    .headerRight{
      display:flex;
      align-items:center;
      gap: 12px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }

    /* ‚ùÑÔ∏è –±–∞–Ω–∫ —Å–Ω–µ–∂–∏–Ω–æ–∫ (—Å–∫—Ä—ã—Ç, —á—Ç–æ–±—ã reset –Ω–µ –ª–æ–º–∞–ª—Å—è) */
    .snowBank{
      display:none;
    }

    .topBtns{
      display:flex;
      gap: 10px;
      align-items:center;
    }

    .btn{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.85);
      color: var(--ink);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 800;
      min-height: var(--tap);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    .btn:hover{ background: rgba(255,255,255,.95); }
    .btn:active{ transform: translateY(1px); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    /* ‚úÖ –í–û–¢ –°–ê–ú–´–ô –í–ê–ñ–ù–´–ô –ö–£–°–û–ö: Total disabled –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –æ–±—ã—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
    .btn.totalBtn:disabled{
      opacity: 1;
      cursor: default;
      background: rgba(255,255,255,.85);
      color: var(--ink);
      border-color: var(--line);
    }

    .layout{
      display:grid;
      grid-template-columns: 260px 1fr;
      gap: 14px;
      padding: 12px 14px 14px;
      align-items: start;
    }

    /* LEFT */
    .sidebar{
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: var(--panel);
      overflow:hidden;
    }
    .sidebarHead{
      padding: 4px 18px 4px !important;
      border-bottom: 1px solid var(--line);
      background: var(--panel2);
    }

    .sidebarHead p{
      margin: 6px 0 0;
      color: var(--ink);
      font-size: 16px;
      line-height: 1.35;
      font-weight: 700;
	  position: relative;
top: -16px;

    }

    .taskList{
      padding: 10px;
      display:flex;
      flex-direction:column;
      gap: 4px;
    }

    .taskBtn{
      width:100%;
      justify-content:space-between;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.86);
      color: var(--ink);
      cursor:pointer;
      min-height: var(--tap);
      font-weight: 900;
      display:flex;
      align-items:center;
      gap: 10px;
      -webkit-tap-highlight-color: transparent;
    }
    .taskBtn:hover{ background:#FFFBEF; }
    .taskBtn.active{
      background: #FFFFF0;
      border-color: rgba(245,200,90,.45);
    }

    .taskBtn .left{
      display:flex;
      flex-direction:column;
      gap: 3px;
      text-align:left;
    }
    .taskBtn .left .small{
      color: var(--muted);
      font-weight: 800;
      font-size: 12px;
    }
    .taskBtn .right{
      display:flex;
      align-items:center;
      gap: 8px;
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
      white-space:nowrap;
    }
    .badge{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.78);
      padding: 4px 8px;
      border-radius: 999px;
    }
    .doneDot{
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(17,24,39,.16);
      border: 1px solid rgba(17,24,39,.12);
    }
    .doneDot.done{
      background: rgba(22,163,74,.75);
      border-color: rgba(22,163,74,.75);
    }

    /* RIGHT */
    .stage{
      border: 1px solid var(--line);
      border-radius: var(--radius);
      overflow:hidden;
      position: relative;
      background: var(--panel);
    }
    .stageHead{
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 12px;
      background: var(--panel2);
    }
    .stageHead h2{ margin:0; font-size: 16px; letter-spacing:.2px; color: var(--ink); }
    .stageHead p{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
    }

    .stats{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }
    .stat{
      min-width: 160px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.86);
      padding: 6px 10px;
      border-radius: 16px;
      display:flex;
      flex-direction:column;
      gap: 2px;
    }
    .stat .k{ color: var(--muted); font-size: 11px; font-weight:800; }
    .stat .v{ font-size: 16px; font-weight: 900; letter-spacing:.3px; color: var(--ink); }

    .stageBody{
      padding: 8px 12px 12px;
      background: var(--warm-sand);
    }

    .note{ color: var(--muted); font-size: 13px; line-height:1.45; }

    .stageFoot{
      padding: 10px 12px;
      border-top: 1px solid var(--line);
      display:flex;
      justify-content:flex-start;
      align-items:center;
      gap: 10px;
      flex-wrap:wrap;
      background: var(--panel2);
    }

    /* Pause overlay */
    .pauseOverlay{
      position:absolute;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap: 10px;
      background: rgba(255,255,255,.82);
      backdrop-filter: blur(6px);
      z-index: 10;
      text-align:center;
      padding: 16px;
      color: var(--ink);
    }
    .pauseOverlay.show{ display:flex; }
    .pauseOverlay .big{ font-size: 26px; font-weight: 900; letter-spacing:.4px; }
    .pauseOverlay .small{ color: var(--muted); font-weight: 800; font-size: 13px; }

    .isPaused .stageBody,
    .isPaused .stageFoot{
      pointer-events: none;
      user-select: none;
    }

    /* ===== MCQ rows ===== */
    /* === Task 3 inner scroll === */
.task3Scroll{
  max-height: 420px;
  overflow-y: auto;
  padding-right: 6px;
}
.task3Scroll::-webkit-scrollbar{
  width: 6px;
}
.task3Scroll::-webkit-scrollbar-thumb{
  background: rgba(17,24,39,.25);
  border-radius: 6px;
}

	.qList{ display:flex; flex-direction:column; gap: 10px; margin-top: 6px; }
    .qRow{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.86);
      border-radius: 16px;
      padding: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .qText{
  font-weight: 600;     /* –æ–±—ã—á–Ω—ã–π, —á–∏—Ç–∞–µ–º—ã–π */
  font-size: 17px;      /* —á—É—Ç—å –∫—Ä—É–ø–Ω–µ–µ */
  line-height: 1.35;    /* –≤–æ–∑–¥—É—Ö –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫ */
  color: var(--ink);
}

    .qBtns{ display:flex; gap: 8px; flex-wrap:wrap; justify-content:flex-end; }
    .opt{
  border: 1px solid var(--line);
  background: rgba(255,255,255,.86);
  color: var(--ink);
  border-radius: 14px;
  padding: 10px 12px;

  cursor: pointer;

  font-weight: 600;     /* üëà –æ–±—ã—á–Ω—ã–π */
  font-size: 16px;      /* üëà –∫–∞–∫ —Ç–µ–∫—Å—Ç */
  min-height: 42px;
  min-width: 60px;
}

    .opt:hover{ background: rgba(255,255,255,.96); }
    .opt:active{ transform: translateY(1px); }
    .opt.locked{
      cursor:default;
      background: rgba(22,163,74,.14);
      border-color: rgba(22,163,74,.32);
    }
	.opt.selected{
  border-color: rgba(245,200,90,.55);
  background: #FFFBEF;
}
    .opt.wrong{
      background: rgba(220,38,38,.14);
      border-color: rgba(220,38,38,.30);
    }
/* === Task 1 inner scroll === */
.task1Scroll{
  max-height: 420px;
  overflow-y: auto;
  padding-right: 6px;
}
.task1Scroll::-webkit-scrollbar{
  width: 6px;
}
.task1Scroll::-webkit-scrollbar-thumb{
  background: rgba(17,24,39,.25);
  border-radius: 6px;
}
/* === Task 2 inner scroll === */
.task2Scroll{
  max-height: 420px;
  overflow-y: auto;
  padding-right: 6px;
}
.task2Scroll::-webkit-scrollbar{
  width: 6px;
}
.task2Scroll::-webkit-scrollbar-thumb{
  background: rgba(17,24,39,.25);
  border-radius: 6px;
}
/* === Task 9 inner scroll === */
.task9Scroll{
  max-height: 420px;
  overflow-y: auto;
  padding-right: 6px;
}
.task9Scroll::-webkit-scrollbar{
  width: 6px;
}
.task9Scroll::-webkit-scrollbar-thumb{
  background: rgba(17,24,39,.25);
  border-radius: 6px;
}
/* === Task 6 inner scroll === */
.task6Scroll{
  max-height: 420px;
  overflow-y: auto;
  padding-right: 6px;
}
.task6Scroll::-webkit-scrollbar{
  width: 6px;
}
.task6Scroll::-webkit-scrollbar-thumb{
  background: rgba(17,24,39,.25);
  border-radius: 6px;
}

    /* ===== Task 4 odd one out ===== */
    .oddGrid{ display:flex; flex-direction:column; gap: 6px; margin-top: 4px; }
    .oddRow{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.86);
      border-radius: 16px;
      padding: 8px;
      display:grid;
      grid-template-columns: repeat(5, minmax(0,1fr));
      gap: 8px;
    }

    /* ===== Task 5 drag-sort words ===== */
    .sortArea{
      margin-top: 8px;
      display:grid;
      gap: 12px;
      align-items:start;
    }
    .sortWordsArea{
  grid-template-columns: 300px 240px 240px;
  column-gap: 20px;
}


    .pool{
      border: 1px solid var(--line);
      border-radius: 18px;
      background: rgba(255,255,255,.86);
      padding: 12px;
      min-height: 250px;
    }
    .poolTitle{
      font-weight: 900;
      font-size: 13px;
      margin-bottom: 10px;
      color: var(--ink);
    }
    .items{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      align-items:start;
      justify-content:start;
    }
    .chip{
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(255,255,255,.92);
      font-weight: 700;
      text-align:center;
      cursor: grab;
      user-select:none;
      min-height: 46px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 15px;
      color: var(--ink);
      width: 100%;
    }
    .chip:active{ cursor: grabbing; }
    .chip.wrong{
      background: rgba(220,38,38,.14);
      border-color: rgba(220,38,38,.30);
    }

    .bin{
      border: 2px dashed rgba(17,24,39,.18);
      border-radius: 18px;
      background: rgba(255,255,255,.72);
      padding: 12px;
      min-height: 260px;
    }
    .binHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 8px;
      margin-bottom: 10px;
    }
    .binTitle{ font-weight: 900; font-size: 13px; color: var(--ink); }
    .binHint{ color: var(--muted); font-size: 12px; font-weight: 900; }
    .bin.dropOk{
      border-color: rgba(22,163,74,.45);
      background: rgba(22,163,74,.08);
    }

    /* ===== Task 7 IPA rows ===== */
	
    .ipaRows{ display:flex; flex-direction:column; gap: 10px; margin-top: 8px; }
    .ipaRow{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.86);
      border-radius: 16px;
      padding: 10px;
      display:grid;
      grid-template-columns: 90px 1fr;
      gap: 10px;
      align-items:center;
    }
    .ipaBadge{
      border: 1px solid rgba(59,130,246,.22);
      background: rgba(191,219,254,.35);
      border-radius: 14px;
      padding: 10px 8px;
      text-align:center;
      font-weight: 700;
      font-size: 15px;
      color: var(--ink);
      letter-spacing: .2px;
    }
    .wordLine{ display:flex; flex-wrap:wrap; gap: 10px; justify-content:flex-start; }
    .wBtn{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.92);
      color: var(--ink);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 700;
      font-size: 16px;
      min-height: 44px;
      cursor:pointer;
    }
    .wBtn.good{
      background: rgba(22,163,74,.14);
      border-color: rgba(22,163,74,.32);
    }
    .wBtn.bad{
      background: rgba(220,38,38,.14);
      border-color: rgba(220,38,38,.30);
    }
    .ipaRow.locked .wBtn{ cursor: default; opacity: .82; }
	/* ===== Task 7 MATCH (Yes / No, can / may / have to) ===== */
.matchWrap{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 10px;
  max-width: 760px;
}

.matchCol{
  display:flex;
  flex-direction:column;
  gap: 10px;
}


    /* ===== Task 8 MEMORY (food) ===== */
    .memGrid{
  margin-top: 10px;
  margin-left: 50px;          /* ‚Üê –°–î–í–ò–ì –í–ü–†–ê–í–û (–ø–æ–∏–≥—Ä–∞–π 10‚Äì24px) */
  display:grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 8px;
  max-width: 760px;
}


    .memCard{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.86);
      border-radius: 18px;
      min-height: 100px;
      cursor: pointer;
      position: relative;
      padding: 0;
      display:block;
      overflow:hidden;
      box-shadow: 0 10px 24px rgba(17,24,39,.08);
    }

    .memInner{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
    }

    .memFront{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 26px;
      font-weight: 900;
      color: var(--ink);
    }

    .memBack{
      opacity: 0;
      transform: scale(.98);
      transition: opacity .18s ease, transform .18s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 10px;
    }

    .memBack img{
      width: 96px;
      height: 96px;
      object-fit: contain;
      filter: drop-shadow(0 10px 16px rgba(17,24,39,.10));
    }

    .memBack .word{
      margin:0;
      text-align:center;
      font-size: 20px;
      font-weight: 900;
      color: var(--ink);
    }

    .memCard.open .memBack{
      opacity: 1;
      transform: scale(1);
    }

    .memCard.open .memFront{
      opacity: 0;
    }

    .memCard.matched{
      outline: 3px solid rgba(22,163,74,.22);
      border-color: rgba(22,163,74,.35);
      cursor: default;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="app">

      <header>
        <div class="title">
          <h1>Back to School: Winter Edition - 4</h1>
          <p class="sub"></p>
        </div>

        <div class="headerRight">
          <div class="snowBank" id="snowBank" aria-hidden="true"></div>

          <div class="topBtns">
            <button class="btn totalBtn" id="totalBtn" type="button" disabled>Total: 0/0</button>
            <button class="btn" id="pauseBtn" title="–ü–∞—É–∑–∞">Pause</button>
            <button class="btn" id="shuffleBtn" title="–ü–µ—Ä–µ–º–µ—à–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è">‚ü≤ Shuffle</button>
            <button class="btn" id="resetAllBtn" title="–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë">‚Üª Reset</button>
          </div>
        </div>
      </header>

      <div class="layout">
        <!-- LEFT -->
        <aside class="sidebar">
          <div class="sidebarHead">
            <h2>  </h2>
            <p>   –í—ã–±–µ—Ä–∏ Task –∏ –≤—ã–ø–æ–ª–Ω–∏ –∑–∞–¥–∞–Ω–∏–µ.</p>
          </div>
          <div class="taskList" id="taskList"></div>
        </aside>

        <!-- RIGHT -->
        <section class="stage" id="stage">
          <div class="stageHead">
            <div>
              <h2 id="taskTitle">–í—ã–±–µ—Ä–∏ Task —Å–ª–µ–≤–∞</h2>
              <p id="taskDesc" class="note"></p>
            </div>

            <div class="stats">
              <div class="stat">
                <div class="k">Progress</div>
                <div class="v" id="progVal">0/0</div>
              </div>
              <div class="stat">
                <div class="k">Mistakes</div>
                <div class="v" id="mistVal">0</div>
              </div>
            </div>
          </div>

          <div class="stageBody" id="stageBody">
            <div class="note">–í—ã–±–µ—Ä–∏ Task —Å–ª–µ–≤–∞.</div>
          </div>

          <div class="stageFoot">
            <div class="note" id="statusNote">–°—Ç–∞—Ç—É—Å: –æ–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –∑–∞–¥–∞–Ω–∏—è.</div>
          </div>

          <div class="pauseOverlay" id="pauseOverlay" aria-hidden="true">
            <div class="big">–ü–∞—É–∑–∞</div>
            <div class="small">–ù–∞–∂–º–∏ ‚ÄúResume‚Äù, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    const $ = (sel)=>document.querySelector(sel);

    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }

    function toast(msg){ /* disabled */ }

    /* =========================
       DATA
    ========================== */
   const TASK1_TO_BE = [
  // --- choose BE (am/is/are) ---
  { text: "Look! The bus ___ coming.", opts:["am","is","are"], ans:"is" },
  { text: "The children ___ drawing animals today.", opts:["am","is","are"], ans:"are" },
  { text: "The cat ___ sleeping on the sofa.", opts:["am","is","are"], ans:"is" },
  { text: "My sister ___ reading a book now.", opts:["am","is","are"], ans:"is" },
  { text: "I'm at the beach. I ___ surfing with my friends!", opts:["am","is","are"], ans:"am" },
  { text: "Listen! Someone ___ playing the violin.", opts:["am","is","are"], ans:"is" },

  // --- choose MAIN verb (V-ing) ---
  { text: "I am ___ in the pool now.", opts:["swiming","swim","swimming"], ans:"swimming" },
  { text: "Tom and Ann are ___ today.", opts:["skiing","ski","sking"], ans:"skiing" },
  { text: "Harry is ___ in the park.", opts:["skating","skates","skateing"], ans:"skating" },
  { text: "She is ___ a letter to her friend.", opts:["writing","write","writeing"], ans:"writing" },
  { text: "The children aren't ___ TV now.", opts:["watch","watching","watches"], ans:"watching" },
  { text: "Mary isn't ___ lessons today.", opts:["have","having","haveing"], ans:"having" },
  { text: "The bird ___ singing in the tree.", opts:["am","is","are"], ans:"is" },
{ text: "It is ___  outside. Take your umbrella.", opts:["raining","rain","raing"], ans:"raining" },
{ text: "Dad is ___ dinner.", opts:["cooking","cook","cooks"], ans:"cooking" },
{ text: "We aren‚Äôt ___ to school today.", opts:["going","go","goes"], ans:"going" },

];


    const TASK2_HAVE_GOT = [
    // much / many / a lot of
  { text:"There are ___ tomatoes in the salad.", opts:["much","a lot of","many"], ans:"a lot of" },
  { text:"Do we need ___ cheese for pizza?", opts:["much","many","a lot"], ans:"much" },
  { text:"I take ___ sugar in my tea.", opts:["many","much","a lot of"], ans:"a lot of" },
  { text:"There aren‚Äôt ___ eggs in the fridge.", opts:["much","many","a lot"], ans:"many" },
  { text:"There is ___ water in the bottle.", opts:["much","many","a lot of"], ans:"a lot of" },
  { text:"We haven't got ___ oranges.", opts:["much","many","a lot of"], ans:"many" },

  // how much / how many ‚Äî questions
  { text:"___ apples are there?", opts:["How much","How many","How"], ans:"How many" },
  { text:"___ sugar is there?", opts:["How much","How many","How"], ans:"How much" },

  // short answers
  { text:"How many bananas are there? ‚Äî ___!", opts:["Not much","A lot","Much"], ans:"A lot" },
  { text:"How much flour is there? ‚Äî ___!", opts:["Many","Not much","A lot of"], ans:"Not much" },
  { text:"How many mangoes are there? ‚Äî ___!", opts:["Not many","Not much","Much"], ans:"Not many" },

  // containers
  { text:"Can I have a ___ of biscuits, please?", opts:["packet","bottle","jar"], ans:"packet" },
  { text:"There is a ___ of milk on the table.", opts:["carton","jar","tin"], ans:"carton" },
  { text:"We‚Äôve got a ___ of jam.", opts:["jar","bottle","packet"], ans:"jar" },
  { text:"I want a ___ of chocolate.", opts:["bar","loaf","carton"], ans:"bar" },
  { text:"There is a ___ of bread on the table.", opts:["loaf","packet","jar"], ans:"loaf" },
];


    const TASK3_LEXIS = [
  { text:"My mum‚Äôs got green ___ .", opts:["eyes","ears"], ans:"eyes" },
  { text:"Uncle Jack is ___ and slim.", opts:["long","tall"], ans:"tall" },
   { text:"You can open doors with ___ .", opts:["gloves","keys"], ans:"keys" },
  { text:"You can use a ___ to play music.", opts:["guitar","camera"], ans:"guitar" },
  { text:"He‚Äôs got big ___ .", opts:["ears","nose"], ans:"ears" },
  { text:"The boy is very ___ . He always tells jokes.", opts:["funny","kind"], ans:"funny" },
  { text:"She works in a hospital. She wears a ___ every day.", opts:["uniform","dress"], ans:"uniform" },
{ text:"A ___ serves food and drinks .", opts:["baker","waiter"], ans:"waiter" },
{ text:"A ___ works at the post office .", opts:["postman","doctor"], ans:"postman" },
  { text:"My aunt has got dark ___ hair.", opts:["short","tall"], ans:"short" },
  { text:"Ann is ___ . Today is her 10th birthday.", opts:["sad","happy"], ans:"happy" },
  { text:"Oh, you've got a new ___ ! What time is it?", opts:["watch","camera"], ans:"watch" },
  { text:"Wear a ___ when you ride a motorbike.", opts:["helmet","cap"], ans:"helmet" },
   { text:"You can brush your hair with a ___ .", opts:["hairbrush","toothbrush"], ans:"hairbrush" },
  { text:"You can talk to your friend on a ___ .", opts:["mobile phone","CD"], ans:"mobile phone" },
  { text:"A mechanic works in a ___ .", opts:["garage","caf√©"], ans:"garage" },
];



    const TASK4_ODD_ROWS = [
      
  { words:["apple","banana","mango","tomato","milk"], odd:"milk" },
  { words:["bread","cheese","butter","sugar","egg"], odd:"egg" },
  { words:["packet","bottle","jar","carton","bread"], odd:"bread" },
  { words:["baker","waiter","postman","mechanic","hospital"], odd:"hospital" },
  { words:["garage","caf√©","post office","hospital","teacher"], odd:"teacher" },
 { words:["tall","short","slim","green","plump"], odd:"green" },
  { words:["swim","ski","skate","sail","cook"], odd:"cook" },
  { words:["kind","clever","funny","friendly","tall"], odd:"tall" },
  { words:["volleyball","tennis","badminton","hockey","chess"], odd:"chess" },

];

   

    const TASK5_WORDS = [
  // HOW MANY (countable)
  { w:"egg",    cat:"many" },
  { w:"apple",  cat:"many" },
  { w:"banana", cat:"many" },
  { w:"orange", cat:"many" },
  { w:"tomato",cat:"many" },
  { w:"carrot", cat:"many" },
  { w:"biscuit",cat:"many" },
  { w:"potato", cat:"many" },
  { w:"mango",   cat:"many" },
  { w:"coconut", cat:"many" },
  { w:"burger", cat:"many" },

  // HOW MUCH (uncountable)
  { w:"milk",    cat:"much" },
  { w:"water",   cat:"much" },
  { w:"juice",   cat:"much" },
  { w:"flour",     cat:"much" },
  { w:"salt",  cat:"much" },
  { w:"rice",    cat:"much" },
  { w:"bread",   cat:"much" },
  { w:"cheese",  cat:"much" },
  { w:"sugar",   cat:"much" },
  { w:"butter",  cat:"much" },
];



    const TASK6_MIX = [
 
  {
    text: "You ___ be quiet in the library.",     opts: ["must", "mustn't"],     ans: "must"   },
  {
    text: "She ___ wear a uniform. She is a nurse in a hospital.",     opts: ["has to", "doesn't have to"],     ans: "has to"   },
  
  {
    text: "You ___ eat in class.",     opts: ["must", "mustn't"],     ans: "mustn't"   },
  {
    text: "Tom is a waiter. He ___ serve food and coffee.",     opts: ["has to", "doesn't have to"],     ans: "has to"   },
  {
    text: "You ___ open the window, it‚Äôs very hot.",     opts: ["may not", "may"],     ans: "may"   },
  {
    text: "She is a good swimmer. She ___ swim very well.",     opts: ["can't", "can"],     ans: "can"   },
  {
    text: "You ___ wash your hands before dinner.",     opts: ["must", "mustn't"],     ans: "must"   },
  {
    text: "You ___ wear a helmet when you ride a motorbike.",     opts: ["have to", "don't have to"],     ans: "have to"   },
  
  {
    text: "I ___ be on time for school.",     opts: ["have to", "don't have to"],     ans: "have to"   },
  {
    text: " ___ I take your pen, please?",     opts: ["May", "Must"],     ans: "May"   },
  {
  text:"You ___ go outside now. The lesson is over.",   opts:["may","may not"],   ans:"may" },
  {
  text:"You ___ listen to the teacher.",   opts:["must","mustn't"],   ans:"must" },


];



    const TASK7_YESNO = [

{ left:"Do you like this game?", right:"Yes, it's fun." },
  { left:"What does she look like?", right:"She is tall and slim." },
  { left:"How old is your grandma?", right:"Sixty-two." },
  { left:"What time is Ann's party?", right:"At half past eight." },
  { left:"Are you listening to me?", right:"Yes, I am." },
  { left:"Can I have a loaf of bread, please?", right:"Yes, of course. Here you are." },
  { left:"How often do you go to the cinema?", right:"Twice a month." },
  { left:"What time is it?", right:"It's ten o'clock." },
  { left:"Excuse me, where's the station?", right:"It's in Bridge Street." },
];



    const TASK8_MEMORY = [
  { id:"mechanic",        word:"mechanic",        img:"images/mechanic.jpg" },
  { id:"cafe",         word:"caf√©",         img:"images/cafe.jpg" },
  { id:"greengrocer",  word:"greengrocer",  img:"images/greengrocer.jpg" },
  { id:"hospital",     word:"hospital",     img:"images/hospital.jpg" },
  { id:"nurse",        word:"nurse",        img:"images/nurse.jpg" },
  { id:"postman",      word:"postman",      img:"images/postman.jpg" },
  { id:"postoffice",   word:"post office",  img:"images/postoffice.jpg" },
  { id:"school",       word:"school",       img:"images/school.jpg" },
    { id:"theatre",      word:"theatre",      img:"images/theater.jpg" },
  { id:"waiter",       word:"waiter",       img:"images/waiter.jpg" },
];


const TASK_LIKES = [
  { text: "We always ___ to the cinema on Sundays.", opts:["go","goes","going"], ans:"go" },
  { text: "She usually ___ hot milk in the evening.", opts:["drink","drinks","drinking"], ans:"drinks" },
  { text: "They ___ to school by bus.", opts:["go","goes","going"], ans:"go" },
  { text: "He ___ like shopping.", opts:["doesn‚Äôt","don‚Äôt","isn‚Äôt"], ans:"doesn‚Äôt" },
  { text: "I sometimes ___ my mum.", opts:["help","helps","helping"], ans:"help" },
  { text: "We ___ watch TV in the morning.", opts:["don‚Äôt","doesn‚Äôt","aren‚Äôt"], ans:"don‚Äôt" },
  { text: "___ you often clean your room?", opts:["Do","Does","Are"], ans:"Do" },
  { text: "___ he play sports after school?", opts:["Do","Does","Is"], ans:"Does" },
  { text: "She never ___ to school on Sundays.", opts:["go","goes","going"], ans:"goes" },
  { text: "I ___ up early on weekdays.", opts:["get","gets","getting"], ans:"get" },
  { text: "How often ___ they play tennis?", opts:["do","does","are"], ans:"do" },
  { text: "He ___ read books in the afternoon.", opts:["doesn‚Äôt","don‚Äôt","isn‚Äôt"], ans:"doesn‚Äôt" },
  { text: "She often ___ her grandma.", opts:["visit","visits","visiting"], ans:"visits" },
{ text: "We ___ like cold weather.", opts:["don‚Äôt","doesn‚Äôt","aren‚Äôt"], ans:"don‚Äôt" },
{ text: "___ he usually have breakfast at home?", opts:["Do","Does","Is"], ans:"Does" },
{ text: "They ___ football after school.", opts:["play","plays","playing"], ans:"play" },

];


   const tasks = [
  { id:1, btn:"Task 1", tag:"present continuous",  type:"mcq",      title:"Task 1 - Present Continuous", desc:"Choose the correct verb form." },
  { id:2, btn:"Task 2", tag:"present simple",      type:"mcq",      title:"Task 2 - Present Simple",     desc:"Choose the correct verb form." },
  { id:3, btn:"Task 3", tag:"vocabulary",          type:"mcq",      title:"Task 3 - Vocabulary",         desc:"Click the correct word." },

  // –ø–æ–∫–∞ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è ‚Üí —Å—Ç–∞–≤–∏–º –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ (–º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –ø–æ–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ title/tag/desc)
  { id:4, btn:"Task 4", tag:"food & shopping",               type:"mcq",      title:"Task 4 - Food & Shopping",                       desc:"Read and choose the correct option." },

  { id:5, btn:"Task 5", tag:"odd one out",         type:"odd",      title:"Task 5 - Odd one out",        desc:"Click the odd word out." },
  { id:6, btn:"Task 6", tag:"categories", type:"sortWords",title:"Task 6 - How much / How many",desc:"Drag the words into the correct box." },

  // —Ç–æ–∂–µ –ø–æ–∫–∞ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è
  { id:7, btn:"Task 7", tag:"modal verbs",               type:"mcq",      title:"Task 7 - Modal verbs",                       desc:"Choose the correct option." },
  { id:8, btn:"Task 8", tag:" match",               type:"match",      title:"Task 8 - Match",                       desc:"Match the questions and answers." },

  { id:9, btn:"Task 9", tag:"memory game",         type:"pictures", title:"Task 9 - Places and Jobs",        desc: "Name the numbers. Click the cards. Find the pairs."},
];


    /* =========================
       STATE
    ========================== */
    const state = {
      activeTaskId: null,
      found: 0,
      need: 0,
      mistakes: 0,
      done: new Map(),
      paused: false,
      snowflakes: 0,
      totalDone: 0,
      totalNeed: 0,
    };

    const ui = {
      taskList: $("#taskList"),
      taskTitle: $("#taskTitle"),
      taskDesc: $("#taskDesc"),
      stageBody: $("#stageBody"),
      progVal: $("#progVal"),
      mistVal: $("#mistVal"),
      statusNote: $("#statusNote"),
      resetAllBtn: $("#resetAllBtn"),
      pauseBtn: $("#pauseBtn"),
      shuffleBtn: $("#shuffleBtn"),
      stage: $("#stage"),
      pauseOverlay: $("#pauseOverlay"),
      totalBtn: $("#totalBtn"),
      snowBank: $("#snowBank"),
    };

    function setStats(){
      ui.progVal.textContent = `${state.found}/${state.need}`;
      ui.mistVal.textContent = String(state.mistakes);
    }

    function computeTotalNeed(){
  const memNeed = TASK8_MEMORY.length * 2; // —Å–ª–æ–≤–æ+–∫–∞—Ä—Ç–∏–Ω–∫–∞

  return (
    TASK1_TO_BE.length +     // task 1
    TASK_LIKES.length +      // task 2
    TASK3_LEXIS.length +     // task 3
    TASK2_HAVE_GOT.length +  // task 4
    TASK4_ODD_ROWS.length +  // task 5
    TASK5_WORDS.length +     // task 6
    TASK6_MIX.length +       // task 7
    TASK7_YESNO.length +     // task 8
    memNeed                  // task 9
  );
}



    function updateTotalUI(){
      if(!ui.totalBtn) return;
      ui.totalBtn.textContent = `Total: ${state.totalDone}/${state.totalNeed}`;
    }

    function addCorrect(n = 1){
      state.found += n;
      state.totalDone += n;
      setStats();
      updateTotalUI();
    }

    function togglePause(){
      if(!state.activeTaskId) return;
      state.paused = !state.paused;

      if(state.paused){
        ui.pauseBtn.textContent = "Resume";
        ui.stage.classList.add("isPaused");
        ui.pauseOverlay.classList.add("show");
      }else{
        ui.pauseBtn.textContent = "Pause";
        ui.stage.classList.remove("isPaused");
        ui.pauseOverlay.classList.remove("show");
      }
    }

    function markTaskDone(taskId){
      state.done.set(taskId, { done:true });
      renderTaskButtons();
    }

    function currentTask(){
      return tasks.find(t => t.id === state.activeTaskId) || null;
    }

    function finishTask(taskId){
      ui.statusNote.textContent = "–°—Ç–∞—Ç—É—Å: –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚úÖ –í—ã–±–∏—Ä–∞–π —Å–ª–µ–¥—É—é—â–∏–π Task —Å–ª–µ–≤–∞.";
      toast("–ì–æ—Ç–æ–≤–æ!");
      markTaskDone(taskId);
    }

    /* =========================
       LEFT BUTTONS
    ========================== */
    function renderTaskButtons(){
      ui.taskList.innerHTML = "";
      tasks.forEach(t=>{
        const btn = document.createElement("button");
        btn.className = "taskBtn" + (state.activeTaskId === t.id ? " active" : "");
        btn.type = "button";

        const left = document.createElement("div");
        left.className = "left";
        left.innerHTML = `<div>${t.btn}</div><div class="small">${t.tag}</div>`;

        const right = document.createElement("div");
        right.className = "right";

        const dot = document.createElement("div");
        dot.className = "doneDot" + (state.done.has(t.id) ? " done" : "");

        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = state.done.has(t.id) ? "done" : "‚Äî";

        right.appendChild(dot);
        right.appendChild(badge);

        btn.appendChild(left);
        btn.appendChild(right);

        btn.addEventListener("click", ()=>openTask(t.id));
        ui.taskList.appendChild(btn);
      });
    }

    /* =========================
       SHUFFLE
    ========================== */
    function shuffleAll(){
  // –ù–ï —Ç—Ä–æ–≥–∞–µ–º –ø–æ—Ä—è–¥–æ–∫ –∑–∞–¥–∞—á —Å–ª–µ–≤–∞ ‚Äî –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–º
  const keepId = state.activeTaskId;

  // –µ—Å–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
  if(!keepId){
    toast("Choose a task first");
    return;
  }

  // –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –¢–ï–ö–£–©–ï–ï –∑–∞–¥–∞–Ω–∏–µ: –≤–Ω—É—Ç—Ä–∏ –±—É–¥–µ—Ç –Ω–æ–≤–∞—è –ø–µ—Ä–µ–º–µ—à–∫–∞
  openTask(keepId, { silent:true, reshuffle:true });
  toast("Shuffled ‚úÖ");
}


    /* =========================
       OPEN TASK
    ========================== */
    function openTask(taskId, opts = {}){
      const { silent=false, reshuffle=false } = opts;

      state.paused = false;
      ui.pauseBtn.textContent = "Pause";
      ui.stage.classList.remove("isPaused");
      ui.pauseOverlay.classList.remove("show");

      state.activeTaskId = taskId;
      state.found = 0;
      state.need = 0;
      state.mistakes = 0;
      setStats();

      renderTaskButtons();

      const task = currentTask();
      ui.taskTitle.textContent = task.title;
      ui.taskDesc.textContent = task.desc;
      ui.statusNote.textContent = "–°—Ç–∞—Ç—É—Å: –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–¥–∞–Ω–∏–µ‚Ä¶";

     if(taskId === 1) buildMCQTask(taskId, TASK1_TO_BE);       // Present Continuous
else if(taskId === 2) buildMCQTask(taskId, TASK_LIKES);   // Present Simple
else if(taskId === 3) buildMCQTask(taskId, TASK3_LEXIS);  // Vocabulary

else if(taskId === 4) buildMCQTask(taskId, TASK2_HAVE_GOT); // (extra) –ø–æ–∫–∞ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è ‚Üí have got

else if(taskId === 5) buildOddOneOut(taskId);
else if(taskId === 6) buildSortWords(taskId);

else if(taskId === 7) buildMCQTask(taskId, TASK6_MIX);    // (extra) questions
else if(taskId === 8) buildMatchTask(taskId, TASK7_YESNO);

else if(taskId === 9) buildMemoryGame(taskId);



      if(!silent && reshuffle) toast("New set for next student");
    }

    /* =========================
       BUILDERS
    ========================== */
	function buildMatchTask(taskId, items){
  const left = shuffle(items.map(i => i.left));
  const right = shuffle(items.map(i => i.right));

  state.need = items.length;   // —Å—á–∏—Ç–∞–µ–º –ø–æ –ø–∞—Ä–∞–º
  state.found = 0;
  state.mistakes = 0;
  setStats();

  ui.stageBody.innerHTML = `
    <div class="matchWrap">
      <div class="matchCol" id="leftCol"></div>
      <div class="matchCol" id="rightCol"></div>
    </div>
  `;

  const leftCol = $("#leftCol");
  const rightCol = $("#rightCol");

  let selectedLeft = null;
  let selectedLeftBtn = null;

  // LEFT buttons
  left.forEach(text=>{
    const b = document.createElement("button");
    b.type = "button";
    b.className = "opt";
    b.textContent = text;
    b.dataset.matched = "0";

    b.onclick = ()=>{
      if(state.paused) return;
      if(b.dataset.matched === "1") return;

      // —Å–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö –ù–ï—Å–æ–±—Ä–∞–Ω–Ω—ã—Ö
      [...leftCol.querySelectorAll(".opt")].forEach(x=>{
        if(x.dataset.matched !== "1") x.classList.remove("selected");
      });

      selectedLeft = text;
      selectedLeftBtn = b;
      b.classList.add("selected");
    };

    leftCol.appendChild(b);
  });

  // RIGHT buttons
  right.forEach(text=>{
    const b = document.createElement("button");
    b.type = "button";
    b.className = "opt";
    b.textContent = text;
    b.dataset.matched = "0";

    b.onclick = ()=>{
      if(state.paused) return;
      if(!selectedLeft || !selectedLeftBtn) return;
      if(b.dataset.matched === "1") return;

      const pair = items.find(i => i.left === selectedLeft);

      if(pair && pair.right === text){
        // ‚úÖ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–∞—Ä–∞: –¥–µ–ª–∞–µ–º –ó–ï–õ–Å–ù–´–ú–ò –æ–±–∞ –∏ –±–ª–æ–∫–∏—Ä—É–µ–º –æ–±–∞
        b.dataset.matched = "1";
        selectedLeftBtn.dataset.matched = "1";

        b.classList.add("locked");
        selectedLeftBtn.classList.remove("selected");
        selectedLeftBtn.classList.add("locked");

        b.disabled = true;
        selectedLeftBtn.disabled = true;

        selectedLeft = null;
        selectedLeftBtn = null;

        addCorrect(1);
        if(state.found >= state.need) finishTask(taskId);
      } else {
        // ‚ùå –æ—à–∏–±–∫–∞: –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –∫—Ä–∞—Å–Ω—ã–º, –Ω–∏—á–µ–≥–æ –Ω–µ —Ñ–∏–∫—Å–∏—Ä—É–µ–º
        state.mistakes++;
        setStats();

        b.classList.add("wrong");
        setTimeout(()=>b.classList.remove("wrong"), 600);
      }
    };

    rightCol.appendChild(b);
  });
}


    function buildMCQTask(taskId, items){
      const list = shuffle([...items]);

      state.need = list.length;
      state.found = 0;
      setStats();

     ui.stageBody.innerHTML = `
  <div class="task1Scroll">
    <div class="qList" id="qList"></div>
  </div>
`;





      const host = $("#qList");

      list.forEach((q, idx)=>{
        const row = document.createElement("div");
        row.className = "qRow";
        row.dataset.done = "0";

        const text = document.createElement("div");
        text.className = "qText";
        text.textContent = `${idx+1}) ${q.text}`;

        const btns = document.createElement("div");
        btns.className = "qBtns";

        const opts = shuffle([...q.opts]);

        opts.forEach(opt=>{
          const b = document.createElement("button");
          b.type = "button";
          b.className = "opt";
          b.textContent = opt;

          b.addEventListener("click", ()=>{
            if(state.paused) return;
            if(row.dataset.done === "1") return;

            if(opt === q.ans){
              row.dataset.done = "1";
              b.classList.add("locked");

              [...btns.querySelectorAll(".opt")].forEach(x=>{
                x.disabled = true;
                if(x !== b) x.style.opacity = ".55";
              });

              addCorrect(1);
              if(state.found >= state.need) finishTask(taskId);
            } else {
              state.mistakes++;
              setStats();
              b.classList.add("wrong");
              setTimeout(()=>b.classList.remove("wrong"), 600);
            }
          });

          btns.appendChild(b);
        });

        row.appendChild(text);
        row.appendChild(btns);
        host.appendChild(row);
      });
    }

    function buildOddOneOut(taskId){
      const rows = shuffle([...TASK4_ODD_ROWS]);

      state.need = rows.length;
      state.found = 0;
      setStats();

      ui.stageBody.innerHTML = `<div class="oddGrid" id="oddGrid"></div>`;
      const host = $("#oddGrid");

      rows.forEach((r)=>{
        const row = document.createElement("div");
        row.className = "oddRow";
        row.dataset.done = "0";

        const words = shuffle([...r.words]);

        words.forEach(w=>{
          const b = document.createElement("button");
          b.type = "button";
          b.className = "opt";
          b.textContent = w;

          b.addEventListener("click", ()=>{
            if(state.paused) return;
            if(row.dataset.done === "1") return;

            if(w === r.odd){
              row.dataset.done = "1";
              b.classList.add("locked");
              [...row.querySelectorAll(".opt")].forEach(x=>{
                x.disabled = true;
                if(x !== b) x.style.opacity = ".55";
              });

              addCorrect(1);
              if(state.found >= state.need) finishTask(taskId);
            } else {
              state.mistakes++;
              setStats();
              b.classList.add("wrong");
              setTimeout(()=>b.classList.remove("wrong"), 600);
            }
          });

          row.appendChild(b);
        });

        host.appendChild(row);
      });
    }

    function buildSortWords(taskId){
      state.need = TASK5_WORDS.length;
      state.found = 0;
      setStats();

      ui.stageBody.innerHTML = `
        <div class="sortArea sortWordsArea">
          <div class="pool">
            <div class="poolTitle">Words</div>
            <div class="items" id="wordPool"></div>
          </div>

          <div class="bin" id="binMany" data-cat="many">
  <div class="binHead">
    <div class="binTitle">How many</div>
    <div class="binHint">countable</div>
  </div>
  <div class="items" id="manyItems"></div>
</div>

<div class="bin" id="binMuch" data-cat="much">
  <div class="binHead">
    <div class="binTitle">How much</div>
    <div class="binHint">uncountable</div>
  </div>
  <div class="items" id="muchItems"></div>
</div>
      `;

      const pool = $("#wordPool");
      shuffle([...TASK5_WORDS]).forEach(item=>{
        pool.appendChild(makeChip(item));
      });

      setupBin($("#binMany"));
setupBin($("#binMuch"));


      function makeChip(item){
        const el = document.createElement("div");
        el.className = "chip";
        el.draggable = true;
        el.dataset.word = item.w;
        el.dataset.cat = item.cat;
        el.textContent = item.w;

        el.addEventListener("dragstart", (e)=>{
          if(state.paused){ e.preventDefault(); return; }
          e.dataTransfer.setData("text/plain", item.w);
        });
        return el;
      }

      function setupBin(binEl){
        binEl.addEventListener("dragover", (e)=>{
          if(state.paused) return;
          e.preventDefault();
          binEl.classList.add("dropOk");
        });
        binEl.addEventListener("dragleave", ()=> binEl.classList.remove("dropOk"));
        binEl.addEventListener("drop", (e)=>{
          if(state.paused) return;
          e.preventDefault();
          binEl.classList.remove("dropOk");
          const w = e.dataTransfer.getData("text/plain");
          if(!w) return;
          handlePlace(w, binEl.dataset.cat);
        });
      }

      function handlePlace(word, cat){
        const chip = [...document.querySelectorAll(".chip")].find(x=>x.dataset.word === word);
        if(!chip) return;

        const correct = chip.dataset.cat === cat;

        if(correct){
let targetBox = $("#manyItems");
if(cat === "much") targetBox = $("#muchItems");


          targetBox.appendChild(chip);
          chip.draggable = false;
          chip.style.cursor = "default";

          addCorrect(1);
          if(state.found >= state.need) finishTask(taskId);
        } else {
          state.mistakes++;
          setStats();
          chip.classList.add("wrong");
          setTimeout(()=>chip.classList.remove("wrong"), 600);
        }
      }
    }

    function buildIPARows(taskId){
      const rows = shuffle(TASK7_IPA_ROWS.map(r=>({
        ipa: r.ipa,
        words: shuffle([...r.words]),
        correct: r.correct
      })));

      state.need = rows.reduce((s,r)=> s + r.correct.length, 0);
      state.found = 0;
      state.mistakes = 0;
      setStats();

      ui.stageBody.innerHTML = `<div class="ipaRows" id="ipaRows"></div>`;
      const host = $("#ipaRows");
      const answered = new Set();

      rows.forEach((r, idx)=>{
        const rowEl = document.createElement("div");
        rowEl.className = "ipaRow";
        rowEl.dataset.done = "0";
        rowEl.dataset.need = String(r.correct.length);
        rowEl.dataset.got = "0";

        const badge = document.createElement("div");
        badge.className = "ipaBadge";
        badge.textContent = r.ipa;

        const line = document.createElement("div");
        line.className = "wordLine";

        r.words.forEach(w=>{
          const b = document.createElement("button");
          b.type = "button";
          b.className = "wBtn";
          b.textContent = w;

          b.addEventListener("click", ()=>{
            if(state.paused) return;
            if(rowEl.dataset.done === "1") return;

            const key = `${idx}|${w}`;
            const isCorrect = r.correct.includes(w);

            if(isCorrect){
              if(answered.has(key)) return;
              answered.add(key);

              b.classList.add("good");
              b.disabled = true;

              addCorrect(1);

              const got = Number(rowEl.dataset.got) + 1;
              rowEl.dataset.got = String(got);

              if(got >= Number(rowEl.dataset.need)){
                rowEl.dataset.done = "1";
                rowEl.classList.add("locked");
                [...line.querySelectorAll(".wBtn")].forEach(x=> x.disabled = true);
              }

              if(state.found >= state.need) finishTask(taskId);
            } else {
              state.mistakes++;
              setStats();
              b.classList.add("bad");
              setTimeout(()=>b.classList.remove("bad"), 550);
            }
          });

          line.appendChild(b);
        });

        rowEl.appendChild(badge);
        rowEl.appendChild(line);
        host.appendChild(rowEl);
      });
    }

    function buildMemoryGame(taskId){
      const deck = [];
      TASK8_MEMORY.forEach(a=>{
        deck.push({ pair:a.id, type:"word", value:a.word });
        deck.push({ pair:a.id, type:"img",  value:a.img  });
      });
	  shuffle(deck);


      // unique numbers 20‚Äì100 (no repeats)
const pool = shuffle(Array.from({ length: 81 }, (_, i) => i + 20)); // 20..100
const numbers = pool.slice(0, deck.length);



      state.need = deck.length;   // 16
      state.found = 0;
      state.mistakes = 0;
      setStats();

      ui.stageBody.innerHTML = `<div class="memGrid" id="memGrid"></div>`;
      const host = $("#memGrid");

      let first = null;
      let second = null;
      let lock = false;

      deck.forEach((card, idx)=>{
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "memCard";
        btn.dataset.i = String(idx);
        btn.dataset.pair = card.pair;
        btn.dataset.type = card.type;
        btn.dataset.matched = "0";

        btn.innerHTML = `
          <div class="memInner">
            <div class="memFront">${numbers[idx]}</div>
            <div class="memBack">
              ${
                card.type === "img"
                  ? `<img src="${card.value}" alt="${card.pair}">`
                  : `<div class="word">${card.value}</div>`
              }
            </div>
          </div>
        `;

        btn.addEventListener("click", ()=>{
          if(state.paused) return;
          if(lock) return;
          if(btn.dataset.matched === "1") return;
          if(btn.classList.contains("open")) return;

          btn.classList.add("open");

          if(!first){
            first = btn;
            return;
          }
          if(first === btn) return;

          second = btn;
          lock = true;

          const isMatch = (first.dataset.pair === second.dataset.pair);

          if(isMatch){
            first.dataset.matched = "1";
            second.dataset.matched = "1";
            first.classList.add("matched");
            second.classList.add("matched");

            addCorrect(2);

            first = null; second = null; lock = false;

            if(state.found >= state.need) finishTask(taskId);
          } else {
           

            setTimeout(()=>{
              first.classList.remove("open");
              second.classList.remove("open");
              first = null; second = null; lock = false;
            }, 650);
          }
        });

        host.appendChild(btn);
      });
    }

    /* =========================
       CONTROLS
    ========================== */
    ui.pauseBtn.addEventListener("click", togglePause);
    ui.shuffleBtn.addEventListener("click", shuffleAll);

    ui.resetAllBtn.addEventListener("click", ()=>{
      state.activeTaskId = null;
      state.found = 0; state.need = 0; state.mistakes = 0;
      state.done.clear();

      state.paused = false;
      ui.pauseBtn.textContent = "Pause";
      ui.stage.classList.remove("isPaused");
      ui.pauseOverlay.classList.remove("show");

      state.snowflakes = 0;
      if(ui.snowBank) ui.snowBank.innerHTML = "";

      state.totalDone = 0;
      updateTotalUI();

      setStats();

      ui.taskTitle.textContent = "–í—ã–±–µ—Ä–∏ Task —Å–ª–µ–≤–∞";
      ui.taskDesc.textContent = "–ù–∞–∂–º–∏ Shuffle, —á—Ç–æ–±—ã –ø–µ—Ä–µ–º–µ—à–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è/–≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—á–µ–Ω–∏–∫–∞.";
      ui.stageBody.innerHTML = `<div class="note">–í—ã–±–µ—Ä–∏ Task —Å–ª–µ–≤–∞.</div>`;
      ui.statusNote.textContent = "–°—Ç–∞—Ç—É—Å: –æ–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –∑–∞–¥–∞–Ω–∏—è.";

      renderTaskButtons();
      toast("Reset done");
    });

    /* ‚úÖ INIT */
    state.totalNeed = computeTotalNeed();
    updateTotalUI();
    renderTaskButtons();
    setStats();
  </script>
</body>
</html>
